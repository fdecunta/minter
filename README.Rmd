---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# minter <img src="man/figures/minter_logo.png" align="right" alt="" width="130" />

<!-- badges: start -->
[![R-CMD-check](https://github.com/fdecunta/minter/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/fdecunta/minter/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/fdecunta/minter/graph/badge.svg)](https://app.codecov.io/gh/fdecunta/minter)
<!-- badges: end -->


Helper functions for conducting meta-analyses of interactions in 2Ã—2 factorial experiments.


## Installation

You can install the development version of minter from [GitHub](https://github.com/) with:

``` r
devtools::install_github("fdecunta/minter", force = TRUE)
```

## Example

You can compute a bunch of effect sizes with one function:

```{r example}
library(minter)

# Load fake data from a 2-by-2 factorial experiment:
# - Insect herbivory (Herb)
# - Fertilization (Fert)
data(fake_data)

# Compute the effect sizes
fake_data <- factorial_effsize(
  effsize = "lnrr",
  colnames = c("Herb", "Fert"),
  data = fake_data,
  Ctrl_mean = C_mean,
  Ctrl_sd = C_sd,
  Ctrl_n = C_n,
  A_mean = Herb_mean,
  A_sd = Herb_sd,
  A_n = Herb_n,
  B_mean = Fert_mean,
  B_sd = Fert_sd,
  B_n = Fert_n,
  AB_mean = HxF_mean,
  AB_sd = HxF_sd,
  AB_n = HxF_n
)

str(fake_data)
```


When non-independence of sampling variances exists, you may use an estimated variance-covariance matrix.

For multiple effect sizes you need multiple matrices. You can do it with one call:

```{r}
vi_cols <- c(
  "Herb_simple_lnRR_var",
  "Fert_simple_lnRR_var",
  "Herb_overall_lnRR_var",
  "Fert_overall_lnRR_var",
  "Herb_x_Fert_lnRR_var"
)

VCVs <- factorial_vcv(
  vi_cols = vi_cols,
  cluster = Study,
  obs = EffectSize_ID,
  rho = 0.5,
  data = fake_data
)

str(VCVs)
```


Use a specific VCV matrix by referencing it using '$':

```{r}
# Overall effect of Insect Herbivores
res_herb <- metafor::rma.mv(
  yi = Herb_overall_lnRR,
  V  = VCVs$Herb_overall_lnRR_var,
  random = ~ 1 | Study,
  test = "t",
  data = fake_data)

# Overall effect of Fertilization
res_fert <- metafor::rma.mv(
  yi = Fert_overall_lnRR,
  V  = VCVs$Fert_overall_lnRR_var,
  random = ~ 1 | Study,
  test = "t",
  data = fake_data)

# Interaction effect 
res_intr <- metafor::rma.mv(
  yi = Herb_x_Fert_lnRR,
  V  = VCVs$Herb_x_Fert_lnRR_var,
  random = ~ 1 | Study,
  test = "t",
  data = fake_data)
```


Aggregate the results from the three models into a single table.


```{r}
models <- list(
  "Insect herbivory" = res_herb,
  "Fertilization" = res_fert,
  "Interaction" = res_intr
)

res_table <- factorial_mod_results(
  models_list = models,
  group = "Study_ID",
)

res_table
```

You may want to visualize this results, and `orchaRd` package has great visualization tools for meta-analyses. So `minter` is designed to work with it. 

The output from `factorial_mod_results` follows the format used by `orchaRd`, and can be directly used in `orchaRd:orchard_plot()`:


```{r}
orchaRd::orchard_plot(
  res_table,
  group = "Study_ID",
  xlab = "lnRR"
)
```







